(this["webpackJsonppdf-editor"]=this["webpackJsonppdf-editor"]||[]).push([[0],{34:function(e,t,n){e.exports=n(63)},39:function(e,t,n){},40:function(e,t,n){},63:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(10),c=n.n(i),o=(n(39),n(2)),l=(n(40),n(3)),s=n.n(l),u=n(5),d=n(1),f=[{name:"pdfjsLib",src:"https://unpkg.com/pdfjs-dist@2.3.200/build/pdf.min.js"},{name:"PDFLib",src:"https://unpkg.com/pdf-lib@1.4.0/dist/pdf-lib.min.js"},{name:"download",src:"https://unpkg.com/downloadjs@1.4.7"},{name:"w3Color",src:"https://www.w3schools.com/lib/w3color.js"}],h={},p=function(e){return h[e]},m={Courier:{correction:function(e,t){return(e*t-e)/2+e/6}},Helvetica:{correction:function(e,t){return(e*t-e)/2+e/10}},"Times-Roman":{correction:function(e,t){return(e*t-e)/2+e/7}}},g=(Object(d.a)(Object(d.a)({},m),{},{"\u6a19\u6977\u9ad4":{src:"/CK.ttf",correction:function(e,t){return(e*t-e)/2}}}),function(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(){return t(a.result)},a.onerror=n,a.readAsArrayBuffer(e)}))}),v=function(e){return new Promise((function(t,n){var a=new Image;if(a.onload=function(){return t(a)},a.onerror=n,e instanceof Blob){var r=window.URL.createObjectURL(e);a.src=r}else a.src=e}))},b=function(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(){return t(a.result)},a.onerror=n,a.readAsDataURL(e)}))},E=function(){var e=Object(u.a)(s.a.mark((function e(t){var n,a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p("pdfjsLib");case 2:return n=e.sent,a=new Blob([t]),r=window.URL.createObjectURL(a),e.abrupt("return",n.getDocument(r).promise);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function x(e,t,n){return y.apply(this,arguments)}function y(){return(y=Object(u.a)(s.a.mark((function e(t,n,a){var r,i,c,o,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p("PDFLib");case 2:return r=e.sent,e.next=5,p("download");case 5:return i=e.sent,e.prev=6,e.t0=r.PDFDocument,e.next=10,g(t);case 10:return e.t1=e.sent,e.next=13,e.t0.load.call(e.t0,e.t1);case 13:c=e.sent,e.next=20;break;case 16:throw e.prev=16,e.t2=e.catch(6),console.log("Failed to load PDF."),e.t2;case 20:return o=c.getPages().map(function(){var e=Object(u.a)(s.a.mark((function e(t,a){var r,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n[a],i=t.getHeight(),o=r.map(function(){var e=Object(u.a)(s.a.mark((function e(n){var a,r,o,l,u,d,f,h,p,m,v,b,E,x,y;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("image"!==n.type){e.next=29;break}if(r=(a=n).file,o=a.x,l=a.y,u=a.width,d=a.height,e.prev=2,"image/jpeg"!==r.type){e.next=13;break}return e.t0=c,e.next=7,g(r);case 7:return e.t1=e.sent,e.next=10,e.t0.embedJpg.call(e.t0,e.t1);case 10:f=e.sent,e.next=20;break;case 13:return e.t2=c,e.next=16,g(r);case 16:return e.t3=e.sent,e.next=19,e.t2.embedPng.call(e.t2,e.t3);case 19:f=e.sent;case 20:return e.abrupt("return",(function(){return t.drawImage(f,{x:o,y:i-l-d,width:u,height:d})}));case 23:throw e.prev=23,e.t4=e.catch(2),console.log("Failed to embed image.",e.t4),e.t4;case 27:e.next=35;break;case 29:if("text"!==n.type){e.next=35;break}return p=(h=n).x,m=h.y,v=h.text,b=h.lineHeight,E=h.fontSize,x=h.fontFamily,h.width,e.next=33,c.embedFont(x);case 33:return y=e.sent,e.abrupt("return",(function(){return t.drawText(v,{font:y,size:E,lineHeight:b,x:p,y:i-E-m})}));case 35:case"end":return e.stop()}}),e,null,[[2,23]])})));return function(t){return e.apply(this,arguments)}}()),e.next=5,Promise.all(o);case 5:e.sent.forEach((function(e){return e()}));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=23,Promise.all(o);case 23:return e.prev=23,e.next=26,c.save();case 26:l=e.sent,i(l,a,"application/pdf"),e.next=34;break;case 30:throw e.prev=30,e.t3=e.catch(23),console.log("Failed to save PDF."),e.t3;case 34:case"end":return e.stop()}}),e,null,[[6,16],[23,30]])})))).apply(this,arguments)}var O,w=n(65),j=n(66),A=n(64),P=n(67),k=n(68),T=n(69),C=(n(42),n(11));!function(e){e.RESET="RESET",e.ADD_ATTACHMENT="ADD_ATTACHMENT",e.REMOVE_ATTACHMENT="REMOVE_ATTACHMENT",e.UPDATE_ATTACHMENT="UPDATE_ATTACHMENT",e.UPDATE_PAGE_INDEX="UPDATE_PAGE_INDEX"}(O||(O={}));var S,D,I,R,N={pageIndex:-1,allPageAttachments:[],pageAttachments:[]},M=function(e,t){var n=e.pageIndex,a=e.allPageAttachments,r=e.pageAttachments;switch(t.type){case O.ADD_ATTACHMENT:var i=a.map((function(e,a){return n===a?[].concat(Object(C.a)(e),[t.attachment]):e}));return Object(d.a)(Object(d.a)({},e),{},{allPageAttachments:i,pageAttachments:i[n]});case O.REMOVE_ATTACHMENT:var c=a.map((function(e,a){return n===a?r.filter((function(e){return e.id!==t.id})):e}));return Object(d.a)(Object(d.a)({},e),{},{allPageAttachments:c,pageAttachments:c[n]});case O.UPDATE_ATTACHMENT:if(-1===n)return e;var o=a.map((function(e,a){return n===a?r.map((function(e){return e.id===t.id?Object(d.a)(Object(d.a)({},e),t.attachment):e})):e}));return Object(d.a)(Object(d.a)({},e),{},{allPageAttachments:o,pageAttachments:o[n]});case O.UPDATE_PAGE_INDEX:return Object(d.a)(Object(d.a)({},e),{},{pageIndex:t.pageIndex,pageAttachments:a[t.pageIndex]});case O.RESET:return{pageIndex:0,pageAttachments:[],allPageAttachments:Array(t.numberOfPages).fill([])};default:return e}};!function(e){e.MOVE="MOVE",e.SCALE="SCALE",e.NO_MOVEMENT="NO_MOVEMENT"}(S||(S={})),function(e){e.RED="red",e.ORANGE="orange",e.YELLOW="yellow",e.OLIVE="olive",e.GREEN="green",e.TEAL="teal",e.BLUE="blue",e.VIOLOET="violet",e.PURPLE="purple",e.BROWN="brown",e.GREY="grey",e.BLACK="black"}(D||(D={})),function(e){e.IMAGE="image",e.TEXT="text"}(I||(I={})),function(e){e.INSERT="insert",e.COMMAND="command"}(R||(R={}));var F=n(9),H=Object(a.forwardRef)((function(e,t){var n=e.listeners,a=e.draggableAttrs,i=e.onBlur,c=e.onChangeText,o=e.editing,l=void 0!==o&&o,s=e.text,u=e.fontSize,f=e.lineHeight,h=e.fontFamily,p=e.style,m=Object(d.a)(Object(d.a)({},n),a),g=((null===s||void 0===s?void 0:s.length)||0)<5?5:null===s||void 0===s?void 0:s.length;return r.a.createElement("input",Object.assign({type:"text",onBlur:i,ref:t,onChange:c,readOnly:!l,style:Object(d.a)({fontSize:u,lineHeight:f,fontFamily:h,outline:"none",padding:0,margin:0,cursor:l?"text":"move",border:"unset",backgroundColor:"unset"},p),value:s,size:g},l?{}:m))})),_=function(e){var t=e.style,n=e.translateX,a=e.translateY,i=e.position,c=e.children;return r.a.createElement("div",{style:Object(d.a)(Object(d.a)({position:"absolute"},i),{},{width:"3rem",height:"3rem",margin:"auto",borderRadius:"9999px",transform:"translateX(".concat(n,") translateY(").concat(a,") rotate(0) skewX(0) skewY(0) scaleX(0.25) scaleY(0.25)")},t)},c)},L=n(19),U=function(e){var t=e.id,n=e.text,i=(e.pageHeight,e.pageWidth,e.removeText),c=e.updateTextAttachment,l=e.fontSize,s=e.lineHeight,u=e.fontFamily,f=e.hidden,h=void 0!==f&&f,p=e.x,m=e.y,g=Object(a.useState)(n||""),v=Object(o.a)(g,2),b=v[0],E=v[1],x=Object(a.useState)(!1),y=Object(o.a)(x,2),O=y[0],w=y[1],j=Object(F.e)({id:t}),A=j.attributes,P=j.node,k=(j.isDragging,j.listeners),T=j.setNodeRef;Object(a.useEffect)((function(){if(O){var e=P.current;e&&(e.focus(),e.select())}else{var t;if(null===(t=document.getSelection())||void 0===t||t.removeAllRanges(),""===b&&i)i();else if(c){c({lines:[b],text:b})}}}),[O]);function C(e){e.stopPropagation(),w(!1)}var S=r.a.createElement(_,{position:{left:0,top:0,right:0},translateX:"0",translateY:"-50%",style:{backgroundColor:"white"}},r.a.createElement(L.c,{onClick:C,style:{cursor:"pointer",color:"#1eb99d",width:"100%",height:"100%"}})),D=r.a.createElement(_,{position:{left:0,top:0,right:0},translateX:"0",translateY:"-50%",style:{backgroundColor:"white"}},r.a.createElement(L.g,{onClick:function(e){i&&(e.stopPropagation(),i())},style:{cursor:"pointer",color:"rgb(245, 101, 101)",width:"100%",height:"100%"}})),I={borderWidth:"0.3px",borderColor:"gray",borderStyle:O?"solid":"dashed"},R=h?{visibility:"hidden"}:{};return r.a.createElement("div",{style:Object(d.a)({position:"absolute",left:"".concat(null!==p&&void 0!==p?p:0,"px"),top:"".concat(null!==m&&void 0!==m?m:0,"px")},R),onDoubleClick:function(e){e.stopPropagation(),w(!0)},onClick:function(e){e.stopPropagation()}},O?S:D,r.a.createElement(H,{ref:T,listeners:k,draggableAttrs:A,onBlur:C,text:b,fontSize:l,lineHeight:s,fontFamily:u,editing:O,onChangeText:function(e){var t=e.currentTarget.value;E(t)},style:I}))},X=Object(a.forwardRef)((function(e,t){var n=e.width,a=e.height,i=e.img,c=e.style,o=e.listeners,l=e.draggableAttrs,s=e.desc;return r.a.createElement("img",Object.assign({style:Object(d.a)({width:n||"100%",height:a||"100%",cursor:"move"},c),src:i.src,ref:t},o,l,{alt:s}))})),G=n(31),Y=function(e){var t=e.id,n=e.img,a=e.width,i=e.height,c=(e.pageWidth,e.removeImage),o=(e.pageHeight,e.hidden),l=void 0!==o&&o,s=e.x,u=e.y,f=e.resizeImage,h=Object(F.e)({id:t}),p=h.attributes,m=(h.isDragging,h.listeners),g=h.setNodeRef;var v=r.a.createElement(_,{position:{left:0,top:0,right:0},translateX:"0",translateY:"-50%",style:{backgroundColor:"white"}},r.a.createElement(L.g,{onClick:function(e){c&&(e.stopPropagation(),c())},style:{cursor:"pointer",color:"rgb(245, 101, 101)",width:"100%",height:"100%"}})),b=r.a.createElement(L.d,{style:{color:"#90cdf4",width:"100%",height:"100%"}}),E=r.a.createElement(_,{position:{left:0,top:0},translateX:"-50%",translateY:"-50%"},b),x=r.a.createElement(_,{position:{right:0,top:0},translateX:"50%",translateY:"-50%"},b),y=r.a.createElement(_,{position:{left:0,bottom:0},translateX:"-50%",translateY:"50%"},b),O=r.a.createElement(_,{position:{right:0,bottom:0},translateX:"50%",translateY:"50%"},b),w=l?{visibility:"hidden"}:{};return r.a.createElement("div",{style:Object(d.a)({position:"absolute",left:"".concat(null!==s&&void 0!==s?s:0,"px"),top:"".concat(null!==u&&void 0!==u?u:0,"px")},w)},r.a.createElement(G.a,{size:{width:a,height:i},onResizeStop:function(e,t,n,a){function r(e){var t=e.replace("px",""),n=parseInt(t);if(n)return n;throw new Error(e+" can't parse to int: "+n+"when parse "+t)}f&&f(r(n.style.width),r(n.style.height))}},E,x,y,O,r.a.createElement(X,{ref:g,listeners:m,draggableAttrs:p,style:{border:"0.3px dashed gray",cursor:"move"},img:n})),c&&v)},z=r.a.createContext(null);function B(e){var t=e.children,n=e.id,a=e.x,i=e.y,c=e.width,o=e.height,l=Object(F.f)({id:n}),s=l.isOver,u=l.setNodeRef,f={color:"gray",borderStyle:"dashed",borderWidth:"1px"};return s&&(f={boxShadow:"inset #1eb99d 0 0 0 3px, rgba(201, 211, 219, 0.5) 20px 14px 24px"}),t&&(f={color:"rgb(245, 101, 101)",borderStyle:"solid"}),r.a.createElement("div",{ref:u,style:Object(d.a)({width:c,height:o,position:"absolute",left:"".concat(null!==a&&void 0!==a?a:0,"px"),top:"".concat(null!==i&&void 0!==i?i:0,"px")},f)},t)}var V=function(e){var t=e.placements,n=e.attachments;return r.a.createElement(r.a.Fragment,null,t.map((function(e){var t=e.id;return r.a.createElement(B,Object.assign({key:t},e),function(e){var t=e.map((function(e){var t=e.id;return r.a.createElement("div",{hidden:!0,key:t})}));return t.length?t:null}(null===n||void 0===n?void 0:n.filter((function(e){return e.column_id===t}))))})))},W=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n,r=1;e>n&&(r=n/e),t>a&&(r=Math.min(r,a/t));var i=e*r,c=t*r;return{width:i,height:c}};function J(e,t){var n=W(e.width,e.height,t.width,t.height),a=n.width,r=n.height,i=t.x,c=t.y;if(a<t.width){var o=t.width-a;i=t.x+o/2}return Object(d.a)(Object(d.a)({},e),{},{x:i,y:c,column_id:t.id,width:a,height:r})}var K,$=function(e){var t=e.placements,n=e.attachments,c=e.pageDimensions,l=e.removeAttachment,s=e.updateAttachment,u=e.scale,f=void 0===u?1:u,h=Object(a.useState)(F.d),p=Object(o.a)(h,2),m=p[0],g=p[1],v=Object(a.useState)(null),b=Object(o.a)(v,2),E=b[0],x=b[1],y=n.map((function(e){return function(e){e.type===I.TEXT?e=function(e){return Object(d.a)(Object(d.a)({},e),{},{x:e.x*f,y:e.y*f,width:e.width*f,height:e.height*f,fontSize:e.fontSize?e.fontSize*f:void 0})}(e):e.type===I.IMAGE&&(e=function(e){var t=e.width,n=e.height;return Object(d.a)(Object(d.a)({},e),{},{x:e.x*f,y:e.y*f,width:t*f,height:n*f})}(e));return e}(e)})),O=t.map((function(e){return Object(d.a)(Object(d.a)({},e),{},{width:e.width*f,height:e.height*f,x:e.x*f,y:e.y*f})})),w=Object(F.g)(F.c,{activationConstraint:{distance:1}}),j=null;if(E){var A=y.find((function(e){return e.id===E}));A.type===I.TEXT?j=r.a.createElement(H,A):A.type===I.IMAGE&&(j=r.a.createElement(X,A))}else j=null;var P=function(e){return function(t){return s(e,t)}};function k(e,t){return e.type===I.IMAGE?r.a.createElement(Y,Object.assign({key:t,hidden:E===e.id,pageWidth:c.width,pageHeight:c.height,removeImage:function(){return l(e.id)},resizeImage:function(t,n){return a=t,r=n,i=e.id,void P(i)({width:a/f,height:r/f});var a,r,i}},e)):r.a.createElement(U,Object.assign({key:t,hidden:E===e.id,pageWidth:c.width,pageHeight:c.height,removeText:function(){return l(e.id)},updateTextAttachment:P(e.id)},e))}return r.a.createElement(z.Consumer,null,(function(e){return r.a.createElement(F.a,{sensors:[w],onDragStart:function(t){var n,a;x(t.active.id),g({x:(null===e||void 0===e||null===(n=e.current)||void 0===n?void 0:n.scrollLeft)||0,y:(null===e||void 0===e||null===(a=e.current)||void 0===a?void 0:a.scrollTop)||0})},onDragEnd:function(e){var a,r=n.find((function(e){return e.id===E}));e.over?a=J(r,t.find((function(t){return t.id===e.over.id}))):a={x:(e.delta.x-m.x)/f+(r.x||0),y:(e.delta.y-m.y)/f+(r.y||0),column_id:void 0};P(e.active.id)(a),x(null)},onDragCancel:function(){return x(null)}},r.a.createElement(V,{placements:O,attachments:n}),y.map((function(e){return k(e,e.id)})),Object(i.createPortal)(r.a.createElement(F.b,null,j),document.body))}))},q=n(16),Q=n.n(q);!function(e){e.PDF="pdf",e.IMAGE="image"}(K||(K={}));var Z=function(e){var t=e.afterUploadPdf,n=e.afterUploadImage,r=e.use,i=Object(a.useState)(!1),c=Object(o.a)(i,2),l=c[0],d=c[1],f=Object(a.createRef)();return{inputRef:f,uploading:l,handleUpload:function(){var e=f.current;e&&(e.value="",d(!0),e.click())},fileOnChange:function(){var e=Object(u.a)(s.a.mark((function e(a){var i,c,o,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=2;break}return e.abrupt("return");case 2:if(i=a.currentTarget.files||a.dataTransfer&&a.dataTransfer.files){e.next=6;break}return d(!1),e.abrupt("return");case 6:if(c=i[0],r!==K.IMAGE){e.next=14;break}return e.next=10,ee(c);case 10:o=e.sent,n&&n(o),e.next=19;break;case 14:if(r!==K.PDF){e.next=19;break}return e.next=17,ne(c);case 17:u=e.sent,t&&t(u);case 19:d(!1);case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}};function ee(e){return te.apply(this,arguments)}function te(){return(te=Object(u.a)(s.a.mark((function e(t){var n,a,r,i,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b(t);case 3:return n=e.sent,e.next=6,v(n);case 6:return a=e.sent,r=Q.a.v4(),i=a.width,c=a.height,e.abrupt("return",{id:r,type:I.IMAGE,width:i,height:c,x:0,y:0,img:a,file:t});case 12:throw e.prev=12,e.t0=e.catch(0),console.log("Failed to load image",e.t0),new Error("Failed to load image");case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function ne(e){return ae.apply(this,arguments)}function ae(){return(ae=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E(t);case 3:return n=e.sent,e.abrupt("return",{file:t,name:t.name,pages:Array(n.numPages).fill(0).map((function(e,t){return n.getPage(t+1)}))});case 7:throw e.prev=7,e.t0=e.catch(0),console.log("Failed to load pdf",e.t0),new Error("Failed to load PDF");case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}var re=function(e){var t=e.children,n=e.onClick,a=e.style;return r.a.createElement("div",{onClick:n,style:Object(d.a)({margin:"0.5rem",float:"left"},a)},t)},ie=function(e){var t=e.attachment,n=e.onClick,a=e.scale,i=void 0===a?1:a,c=e.active;var o=void 0!==c&&c?{color:"#1eb99d",borderStyle:"solid"}:{};return r.a.createElement(re,{onClick:n,style:o},r.a.createElement(X,Object.assign({},function(e){var t=W(e.width,e.height,90),n=t.width,a=t.height;return Object(d.a)(Object(d.a)({},e),{},{x:e.x*i,y:e.y*i,width:n*i,height:a*i})}(t),{style:{cursor:"pointer"}})))},ce=n(30),oe=Object(ce.a)("MY_DB",10,{upgrade:function(e,t,n,a){e.createObjectStore("imageFiles"),e.createObjectStore("pdfs")},blocked:function(){},blocking:function(){},terminated:function(){}});function le(){return(le=Object(u.a)(s.a.mark((function e(t,n){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe;case 2:return a=e.sent,e.next=5,a.put("imageFiles",t,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(){return ue.apply(this,arguments)}function ue(){return(ue=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe;case 2:return t=e.sent,e.next=5,t.getAll("imageFiles");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(){return fe.apply(this,arguments)}function fe(){return(fe=Object(u.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe;case 2:return t=e.sent,n=t.transaction(["imageFiles"],"readwrite"),e.next=6,n.objectStore("imageFiles").clear();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var he=function(){for(var e=[],t=0;t<5;t++)for(var n=0;n<4;n++)e.push({height:50,width:91,x:103+91*t,y:470+50*n,id:"".concat(t,"-").concat(n)});return e},pe=function(e){var t=e.onClick,n=e.children;e.scale;return r.a.createElement(re,null,r.a.createElement(A.a,{style:{width:"100%",height:"5rem"},onClick:t},n))},me=n(28),ge=n.n(me),ve=n(6),be=r.a.createContext({active:!1,activePosition:{x:0,y:0},elementDimensions:{height:0,width:0},elementOffset:{left:0,top:0},itemDimensions:{height:0,width:0},itemPosition:{x:0,y:0},itemRef:void 0,onLoadRefresh:function(){},passivePosition:{x:0,y:0},prevActivePosition:{x:0,y:0}}),Ee=["children","onClick","handleAttachment","addAttachment","scale"],xe=function(e){var t=e.children,n=e.onClick,a=e.handleAttachment,i=e.addAttachment,c=e.scale,o=void 0===c?1:c,l=Object(ve.a)(e,Ee);return r.a.createElement("div",{onClick:function(){if(l.passivePosition){var e=l.passivePosition,t=e.x,r=e.y;if(a&&i){var c=function(e,t,n){var a=n[n.length-1],r=n.filter((function(n){return n.x<e&&e<a.x+a.width&&n.y<t&&t<a.y+a.height})).sort((function(n){return n.x-e+(n.y-t)}));return r&&r.length?r[0]:null}(t/=o,r/=o,he());if(c){var s=J(a,c);i(Object(d.a)(Object(d.a)({},s),{},{id:Q.a.v4()}))}else i(Object(d.a)(Object(d.a)({},a),{},{x:t,y:r,id:Q.a.v4()}))}n&&n(l.passivePosition.x,l.passivePosition.y)}}},r.a.createElement(be.Provider,{value:l},t))},ye=function(e){var t=e.page,n=e.dimensions,i=e.setDimensions,c=e.scale,l=void 0===c?1:c,d=Object(a.useRef)(null),f=Object(a.useState)((null===n||void 0===n?void 0:n.width)||0),h=Object(o.a)(f,2),p=h[0],m=h[1],g=Object(a.useState)((null===n||void 0===n?void 0:n.height)||0),v=Object(o.a)(g,2),b=v[0],E=v[1];return Object(a.useEffect)((function(){function e(){return(e=Object(u.a)(s.a.mark((function e(){var n,a,r,c,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(n=e.sent,a=d.current,!n){e.next=14;break}if(r=null===a||void 0===a?void 0:a.getContext("2d"),c=n.getViewport({scale:l}),m(c.width),E(c.height),!r){e.next=14;break}return e.next=12,n.render({canvasContext:null===a||void 0===a?void 0:a.getContext("2d"),viewport:c}).promise;case 12:o={width:c.width,height:c.height},i&&i(o);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t,i]),r.a.createElement("div",null,r.a.createElement("canvas",{ref:d,width:p,height:b}))},Oe=function(e){var t=e.children,n=e.style,i=Object(a.createRef)();return r.a.createElement(z.Provider,{value:i},r.a.createElement("div",{ref:i,className:"row flex-nowrap",style:Object(d.a)({overflowX:"scroll",overflowY:"scroll",height:"93vh"},n)},t))},we=function(){var e=Object(a.useState)(1.65),t=Object(o.a)(e,2),n=t[0],i=(t[1],Object(a.useState)()),c=Object(o.a)(i,2),l=c[0],d=c[1],f=function(){var e=Object(a.useState)(""),t=Object(o.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(-1),c=Object(o.a)(i,2),l=c[0],d=c[1],f=Object(a.useState)(),h=Object(o.a)(f,2),p=h[0],m=h[1],g=Object(a.useState)(),v=Object(o.a)(g,2),b=v[0],E=v[1],y=Object(a.useState)([]),O=Object(o.a)(y,2),w=O[0],j=O[1],A=Object(a.useState)(!1),P=Object(o.a)(A,2),k=P[0],T=P[1],C=Object(a.useState)(!1),S=Object(o.a)(C,2),D=S[0],I=S[1],R=Object(a.useState)(!1),N=Object(o.a)(R,2),M=N[0],F=N[1],H=Object(a.useState)(!1),_=Object(o.a)(H,2),L=_[0],U=_[1],X=Object(a.useCallback)(m,[m]);return{isMultiPage:k,isFirstPage:D,isLastPage:M,isSaving:L,currentPage:w[l],dimensions:p,setDimensions:X,name:n,setName:r,pageIndex:l,setPageIndex:d,file:b,setFile:E,pages:w,nextPage:function(){var e=l+1;d(l+1),I(0===e),F(e===w.length-1)},savePdf:function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!L&&b){e.next=2;break}return e.abrupt("return");case 2:return U(!0),e.prev=3,e.next=6,x(b,t,n);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),console.log(e.t0);case 11:return e.prev=11,U(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[3,8,11,14]])})));return function(t){return e.apply(this,arguments)}}(),setPdf:function(e){var t=e.name,n=e.file,a=e.pages,i=a.length>1;r(t),E(n),j(a),d(0),T(i),I(!0),F(1===a.length)},previousPage:function(){var e=l-1;d(e),I(0===e),F(e===w.length-1)}}}(),h=f.file,p=f.setPdf,m=f.pageIndex,g=f.isMultiPage,v=f.isFirstPage,b=f.isLastPage,E=f.currentPage,y=(f.isSaving,f.savePdf),C=f.previousPage,S=f.nextPage,D=f.setDimensions,R=(f.name,f.dimensions),F=function(){var e=Object(a.useState)([]),t=Object(o.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!1),c=Object(o.a)(i,2),l=c[0],d=c[1];Object(a.useEffect)((function(){function e(){return(e=Object(u.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se();case 2:return t=e.sent,e.next=5,Promise.all(t.map(function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:n=e.sent,r(n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(function(){return e.apply(this,arguments)})().then()}),[l]);var f=function(){return d(!l)};return{allCandidates:n,refresh:f,removeAllImages:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,de();case 2:f();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}}(),H=F.allCandidates,_=F.removeAllImages,U=F.refresh,X=function(){var e=Object(a.useReducer)(M,N),t=Object(o.a)(e,2),n=t[0],r=t[1],i=n.allPageAttachments;return{pageAttachments:n.pageAttachments,allPageAttachments:i,addAttachment:function(e){return r({type:O.ADD_ATTACHMENT,attachment:e})},resetAttachments:function(e){return r({type:O.RESET,numberOfPages:e})},removeAttachments:function(e){return r({type:O.REMOVE_ATTACHMENT,id:e})},updateAttachments:function(e,t){return r({type:O.UPDATE_ATTACHMENT,id:e,attachment:t})},setPageIndex:Object(a.useCallback)((function(e){return r({type:O.UPDATE_PAGE_INDEX,pageIndex:e})}),[r])}}(),G=X.addAttachment,Y=X.allPageAttachments,z=X.pageAttachments,B=X.resetAttachments,V=X.updateAttachments,W=X.removeAttachments,J=X.setPageIndex,q=!!h,te=Z({use:K.PDF,afterUploadPdf:function(e){p(e);var t=e.pages.length;B(t)}}),ne=te.inputRef,ae=te.handleUpload,re=te.fileOnChange,ce=Z({use:K.IMAGE,afterUploadImage:function(e){(function(e,t){return le.apply(this,arguments)})(e.file,e.id).then((function(){return U()})),d(e)}}),oe=ce.inputRef,ue=ce.handleUpload,fe=ce.fileOnChange;Object(a.useEffect)((function(){return J(m)}),[m,J]);var me=l?"\u9ede\u64ca PDF \u7684\u67d0\u8655\u4f86\u65b0\u589e\u9644\u4ef6":"\u9019\u4e9b\u5716\u7247\u88ab\u5132\u5b58\u5728 local \u7684 IndexedDB\u3002",ve=r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{ref:ne,type:"file",accept:"application/pdf",onChange:re,style:{display:"none"}}),r.a.createElement("input",{ref:oe,type:"file",accept:"image/*",style:{display:"none"},onChange:fe})),be={};g&&!v||(be={visibility:"hidden"});var Ee={};return g&&!b||(Ee={visibility:"hidden"}),r.a.createElement("div",{className:"App"},ve,r.a.createElement(w.a,{fluid:!0},!q&&r.a.createElement(r.a.Fragment,null,r.a.createElement(j.a,{className:"justify-content-center mt-lg-5"},r.a.createElement("div",null,r.a.createElement("h3",null,"\u4e0a\u50b3\u4e00\u4efd Pdf\uff01"),r.a.createElement(A.a,{onClick:ae},r.a.createElement(L.f,null)," Upload")))),r.a.createElement(j.a,null,r.a.createElement(P.a,{sm:3},q&&r.a.createElement("div",{className:"flex-nowrap",style:{overflowY:"scroll",height:"100vh"}},r.a.createElement("h3",null,"\u52a0\u5165\u9644\u4ef6"),r.a.createElement("p",null,me,r.a.createElement(A.a,{variant:"link",onClick:_},"\u6e05\u7a7a\u5716\u7247")),r.a.createElement(pe,{scale:n,onClick:function(){var e={id:Q.a.v4(),type:I.TEXT,x:0,y:0,width:120,height:25,fontSize:16,lineHeight:1.4,fontFamily:"Times-Roman",text:"Enter Text Here"};d(e)}},"\u65b0\u589e\u6587\u5b57"),H.filter((function(e){return e.type===I.IMAGE})).map((function(e){return r.a.createElement(ie,{key:e.id,active:(null===l||void 0===l?void 0:l.id)===e.id,onClick:function(){d(e)},attachment:e,scale:n})})),r.a.createElement(pe,{scale:n,onClick:ue},"\u4e0a\u50b3\u5716\u7247"))),r.a.createElement(P.a,{sm:9,className:"position-relative"},r.a.createElement("div",{className:"d-flex justify-content-between align-items-center",style:{height:"7vh",minHeight:"40px"}},r.a.createElement("div",null,r.a.createElement(A.a,{style:be,className:"rounded-circle",variant:"outline-dark",onClick:C},r.a.createElement(L.a,null))),r.a.createElement("div",null,q&&r.a.createElement(k.a,{className:"justify-content-center"},r.a.createElement(k.a.Link,{onClick:ae},r.a.createElement(L.f,null)," Upload New"),r.a.createElement(k.a.Link,{onClick:function(){return y(Y)}},r.a.createElement(L.e,null)," Save "))),r.a.createElement("div",null,r.a.createElement(A.a,{style:Ee,className:"rounded-circle",variant:"outline-dark",onClick:S},r.a.createElement(L.b,null)))),r.a.createElement(Oe,null,E&&r.a.createElement(ge.a,{trackPassivePosition:!0,cursorStyle:l?void 0:"default"},r.a.createElement(xe,{handleAttachment:l,addAttachment:G,scale:n},r.a.createElement(T.a,{style:{display:"table"}},r.a.createElement(ye,{dimensions:R,setDimensions:D,page:E,scale:n}),R&&r.a.createElement($,{removeAttachment:W,updateAttachment:V,pageDimensions:R,attachments:z,placements:he(),scale:n})))))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));f.forEach((function(e){var t=e.name,n=e.src;h[t]=new Promise((function(e,a){var r=document.createElement("script");r.src=n,r.onload=function(){e(window[t]),console.log("".concat(t," is loaded."))},r.onerror=function(){return a("The script ".concat(t," didn't load correctly."))},document.body.appendChild(r)}))})),c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(we,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[34,1,2]]]);
//# sourceMappingURL=main.cae10af8.chunk.js.map